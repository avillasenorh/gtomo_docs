<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Ray tracing - Global Tomography</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Ray tracing";
        var mkdocs_page_input_path = "preprocessing/trace.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Global Tomography
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Data</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../data/ehb/">EHB bulletin</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../data/preparation/">Data preparation</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Preprocesssing</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Ray tracing</a>
    <ul class="current">
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../clustering/">Clustering</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../selection/">Sorting-Renumbering-Selection</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Global Tomography</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Preprocesssing &raquo;</li><li>Ray tracing</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="ray-tracing">Ray tracing</h1>
<p>The first steps of preprocessing consist of reading the EHB <code>RES</code> files,
verifying that some of the fields are correct, and writing out only the
relevant fields for the tomography. These steps are described using the
term <strong>ray tracing</strong> because one of the checks is that the ray-tracing
parameters in the <code>RES</code> files (distance, azimuth, travel time, ray parameter),
calculated with Buland and Chapman's codes are close enough to the values
obtained with the 1-D ray tracing routines used in the tomography codes.</p>
<p>The main checks carried out by these pre-processing codes are:</p>
<ul>
<li>Verify that the distance and azimuth listed in the <code>RES</code> files are
  similar to the values calculated but the tomography code routines.
  In particular verify that the distance is calculated correctly for
  phases that travel for more that 180 degrees (e.g. P'P'?).</li>
<li>For the phases that have a bounce in the free surface or ocean bottom,
  verify that the coordinates of the bounce point listed in the <code>RES</code> files
  coincides with the one calculated with the tomography codes.</li>
<li>Verify that the ellipticity correction listed in the <code>RES</code> files is similar
  to the ellipticity correction calculated by the subroutine <code>ellip</code>.</li>
<li>Verify that the ray parameter and travel times listed in the <code>RES</code> files
  are similar to the ones calculated by the 1-D ray tracing routines used
  in the tomography codes.</li>
<li>Write out the uncorrected travel time residual (without the patch correction)
  so it contains the full contribution from the 3D structure.</li>
</ul>
<p>The original sequence of programs from <code>RES</code> files to <em>checked</em> files was the following:</p>
<pre><code>input        code            output

RES      -&gt;  preprocess  -&gt;  PREdata
PREdata  -&gt;  read        -&gt;  RDdata
RDdata   -&gt;  ellipt      -&gt;  *ELP
*ELP     -&gt;  trace_bob   -&gt;  *TRACE
*TRACE   -&gt;  checkdata   -&gt;  *CHK
</code></pre>
<p>To reduce the number of input and output files, new pre-processing codes were written:</p>
<ul>
<li><code>res2trace2</code>: combines <code>preprocess</code>, <code>read</code>, and <code>ellipt</code></li>
<li><code>??</code>: combinets <code>trace*</code>, and <code>checkdata</code></li>
</ul>
<p>The final output format of all this processing is:</p>
<pre><code class="language-fortran">    write(6,111) 
     &gt;            ievent,idate,ihour,iminut,sec,
     &gt;            flon,flat,hf,iihold,xmb,xms,
     &gt;            bop,top,xln1,yln1,xln2,yln2,
     &gt;            ntele,ista,xst,yst,delta,derr,disc,az,
     &gt;            ionset,idm1,idx,iph2,iph3,
     &gt;            sfd,sft,tr,terr,ryp,pr,delay1,delay,risc,ifl,
     &gt;            rbd,rb,dbs,dbstat,ucor,ecor,topocor,evcor,prec,
     &gt;            ierror,ierr2,iwhat
111     format(i7,1x,i6,1x,2(i2,1x),1x,f5.2,1x,2(f8.2,1x),f4.0,
     &gt;         1x,i1,1x,2(f3.1,1x),f4.1,1x,f5.1,1x,4(f8.2,1x),
     &gt;         1x,i3,1x,i6,1x,2(f8.2,1x),1x,
     &gt;         3(f6.2,1x),1x,f6.2,1x,i1,1x,4(i3,1x),1x,f6.2,1x,
     &gt;         f7.2,1x,4(f9.2,1x),1x,2(f6.2,1x),f6.1,1x,i1,1x,
     &gt;         f6.0,1x,
     &gt;         f9.2,1x,6(f6.2,1x),i3,1x,i2,1x,i1,1x,i1)
</code></pre>
<p>The meaning of the variables is:</p>
<ul>
<li><code>ievent</code>: event number (un-modified from the original <code>RES</code> files)</li>
<li><code>idate</code>: event origin time date in YYMMDD format (non-Y2K!)</li>
<li><code>ihour</code>, <code>iminut</code>, <code>sec</code>: event origin time hour, minutes, and seconds</li>
<li><code>flon</code>, <code>flat</code>: geocentric longitude and latitude of the event (degrees or radians?)</li>
<li><code>hf</code>: event focal depth in km</li>
<li><code>iihold</code>: solution type (0=free, 1=fixed depth, 2=fixed hypocenter)</li>
</ul>
<p>One last step is program <code>select</code></p>
<p>Input</p>
<pre><code class="language-fortran">        read(5,11,err=1111,end=5)
     &gt;            ievent,idate,ihour,iminut,sec,
     &gt;            flon,flat,hf,iihold,xmb,xms,
     &gt;            bop,top,xln1,yln1,xln2,yln2,
     &gt;            ntele,ista,xst,yst,delta,derr,disc,az,
     &gt;            ionset,idm1,idx,iph2,iph3,
     &gt;            sfd,sft,tr,terr,ryp,pr,delay1,delay,risc,ifl,
     &gt;            rbd,rb,dbs,dbstat,ucor,ecor,topocor,acc,
     &gt;            ierror,iwhat
11      format(i7,1x,i6,1x,2(i2,1x),1x,f5.2,1x,2(f8.2,1x),f4.0,
     &gt;         1x,i1,1x,2(f3.1,1x),f4.1,1x,f5.1,1x,4(f8.2,1x),
     &gt;         1x,i3,1x,i6,1x,2(f8.2,1x),1x,
     &gt;         3(f6.2,1x),1x,f6.2,1x,i1,1x,4(i3,1x),1x,f6.2,1x,
     &gt;         f7.2,1x,4(f9.2,1x),1x,2(f6.2,1x),f6.1,1x,i1,1x,
     &gt;         f6.0,1x,
     &gt;         f9.2,1x,5(f6.2,1x),f3.1,1x,i2,1x,i1)
</code></pre>
<p>Variables not written:</p>
<p>xms
bop
top
xln1, yln1, xln2, yln2
xst, yst
ntele</p>
<p>Output:</p>
<pre><code class="language-fortran">c       output format of Forward/1_*/Src/trace_data.f
        write(6,111) 
     &gt;          ievent,idate,ihour,iminut,sec,
     &gt;          flon, flat, hf,iihold,xmb,
c    &gt;          ista,xst,yst,delta,az,
     &gt;          ista,        delta,az,
     &gt;          ionset,idm1,idx,
     &gt;          tr,pr,delay,ifl,
     &gt;          ierror,iwhat
111    format(i7,1x,i6,1x,2(i2,1x),1x,f5.2,1x,2(f8.2,1x),f4.0,
c    &gt;          1x,i1,1x,f3.1,1x,i6,(2f8.2,1x),f7.2,1x,f6.1,1x,i3,
     &gt;          1x,i1,1x,f3.1,1x,i6,           f7.2,1x,f6.1,1x,i3,
     &gt;          i4,1x,i3,1x,3(f8.2,1x),1x,(3I3))

</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../data/preparation/" class="btn btn-neutral float-left" title="Data preparation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../clustering/" class="btn btn-neutral float-right" title="Clustering">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../data/preparation/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../clustering/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
